(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackages/pay/pay"],{3033:function(e,t,n){"use strict";(function(e){n("921c");i(n("66fd"));var t=i(n("92dc"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},6093:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=u(n("1e31")),a=o(n("c704"));function o(e){return e&&e.__esModule?e:{default:e}}function r(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,t&&t.set(e,n),n}var c={data:function(){return{show:!1,customStyle:{fontSize:"40rpx",lineHeight:"40rpx",height:"40rpx",fontWeight:"bold"},list:[{name:"余额",value:"YE"},{name:"微信",value:"WX"}],wallet:0,orderData:{},payType:"",paymentType:"YE",current:0,youhui:0,zige:!0,startValue:Math.round(100*(30*Math.random()+5))/100,change:!1,kaiguan:"off"}},onShow:function(){this.getWaletDetail()},onLoad:function(e){this.payType=e.payType,0==e.payType&&this.getDiscount(),2==e.payType&&this.getOrderDetail(e.orderId),this.orderData=e},methods:{getPrice:function(){return"on"==this.kaiguan&&this.zige&&this.change?this.orderData.commodityPrice>this.youhui?this.orderData.commodityPrice-this.youhui:(this.list[1]["disabled"]=!0,0):this.orderData.commodityPrice},getDiscount:function(){var e=this;this.$u.api.getDiscount().then((function(t){"on"==t.kaiguan&&(e.kaiguan=t.kaiguan,e.youhui=t.youhui,e.zige=t.zige,t.zige&&e.$refs.uCountTo.start())}))},changePrice:function(){this.change=!0},get:function(){i.getSubscribeMessage()},getOrderDetail:function(e){var t=this;this.$u.api.getOrderDetail({orderId:e}).then((function(e){t.orderData=JSON.parse(e)}))},charge:function(){e.navigateTo({url:"/pages/charge/charge?flag=1"})},radioChange:function(e){this.paymentType=e.detail.value},getWaletDetail:function(){var e=this;this.$u.api.getWaletDetail().then((function(t){e.wallet=t.totalAmount,e.wallet>e.orderData.orderMoney||e.wallet>e.orderData.commodityPrice?(e.current=0,e.paymentType="YE"):(e.current=1,e.paymentType="WX")}))},submit:function(){var t=this,n=this;if(this.paymentType)if("YE"==this.paymentType&&(this.wallet<this.orderData.commodityPrice||this.wallet<this.orderData.orderMoney))e.showToast({title:"余额不足，请充值，或者使用微信支付",icon:"none"});else{if(0==this.payType&&this.$u.api.createOrder({userId:e.getStorageSync("userId"),shopId:this.orderData.shopId,merchantId:this.orderData.merchantId,commodityId:this.orderData.commodityId,commodityPrice:this.getPrice(),carNumber:this.orderData.carNumber,carModel:this.orderData.carModel,userPhone:this.orderData.userPhone,scheduledTime:this.orderData.scheduledTime,orderType:this.orderData.orderType,paymentType:this.paymentType,openId:e.getStorageSync("openid"),orderRemark:this.orderData.orderRemark,discount:"on"==this.kaiguan&&this.zige?1:0,money:this.orderData.commodityPrice}).then((function(o){var r=o.orderId;if("WX"==t.paymentType){var u=i.WX_appId,c=i.getNum(),s="prepay_id="+o.prepayid,d="MD5",p=Date.parse(new Date).toString(),l=i.key,g=a.default.md5("appId="+u+"&nonceStr="+c+"&package="+s+"&signType="+d+"&timeStamp="+p+"&key="+l);wx.requestPayment({timeStamp:p,nonceStr:c,package:s,signType:d,paySign:g,success:function(){n.show=!0;var t=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+r})}),1500)};i.getSubscribeMessage(t)},complete:function(e){console.log(e)}})}if("YE"==t.paymentType){if(500==o.code)return void e.showToast({title:o.message,icon:"none"});n.show=!0;var y=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+r})}),1500)};i.getSubscribeMessage(y)}})),1==this.payType&&this.$u.api.paymentOrder({orderId:this.orderData.orderId,openId:e.getStorageSync("openid"),paymentType:this.paymentType}).then((function(o){var r=o.orderId;if("WX"==t.paymentType){var u=i.WX_appId,c=i.getNum(),s="prepay_id="+o.prepayid,d="MD5",p=Date.parse(new Date).toString(),l=i.key,g=a.default.md5("appId="+u+"&nonceStr="+c+"&package="+s+"&signType="+d+"&timeStamp="+p+"&key="+l);wx.requestPayment({timeStamp:p,nonceStr:c,package:s,signType:d,paySign:g,success:function(t){n.show=!0;var a=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+r})}),1500)};i.getSubscribeMessage(a)},complete:function(e){console.log(e)}})}if("YE"==t.paymentType){n.show=!0;var y=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+r})}),1500)};i.getSubscribeMessage(y)}})),2==this.payType){if("WX"==this.paymentType){var o=this.orderData.id,r=i.WX_appId,u=i.getNum(),c="prepay_id="+this.orderData.prepayId,s="MD5",d=Date.parse(new Date).toString(),p=i.key,l=a.default.md5("appId="+r+"&nonceStr="+u+"&package="+c+"&signType="+s+"&timeStamp="+d+"&key="+p);wx.requestPayment({timeStamp:d,nonceStr:u,package:c,signType:s,paySign:l,success:function(){n.show=!0;var t=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+o})}),1500)};i.getSubscribeMessage(t)},fail:function(t){(new Date).getTime()-n.orderData.createTime>72e5?(e.showLoading({title:"订单支付超时",duration:3e3}),n.$u.api.setOrderStatus({orderId:n.orderData.id,status:"FAIL"}).then((function(t){setTimeout((function(){e.hideLoading(),e.navigateBack()}),1e3)}))):e.showToast({icon:"none",title:"请重新发起支付"})},complete:function(e){}})}"YE"==this.paymentType&&this.$u.api.paymentOrder({orderId:this.orderData.id,openId:e.getStorageSync("openid"),paymentType:this.paymentType}).then((function(i){"YE"==t.paymentType&&(n.show=!0,setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+i.orderId})}),1500))}))}3==this.payType&&this.$u.api.payRescueOrder({orderId:this.orderData.orderId,openId:e.getStorageSync("openid"),paymentType:this.paymentType}).then((function(o){o.orderId;if("WX"==t.paymentType){var r=i.WX_appId,u=i.getNum(),c="prepay_id="+o.prepayid,s="MD5",d=Date.parse(new Date).toString(),p=i.key,l=a.default.md5("appId="+r+"&nonceStr="+u+"&package="+c+"&signType="+s+"&timeStamp="+d+"&key="+p);wx.requestPayment({timeStamp:d,nonceStr:u,package:c,signType:s,paySign:l,success:function(t){console.log(t),n.show=!0;var a=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/rescue/rescue"})}),1500)};i.getSubscribeMessage(a)},complete:function(e){console.log(e)}})}if("YE"==t.paymentType){n.show=!0;var g=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/rescue/rescue"})}),1500)};i.getSubscribeMessage(g)}}))}else e.showToast({title:"请选择支付方式",icon:"none"})}}};t.default=c}).call(this,n("543d")["default"])},"8a9c":function(e,t,n){"use strict";n.r(t);var i=n("6093"),a=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},"92dc":function(e,t,n){"use strict";n.r(t);var i=n("f4ce"),a=n("8a9c");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("b64e");var r,u=n("f0c5"),c=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"317d20c8",null,!1,i["a"],r);t["default"]=c.exports},a8a0:function(e,t,n){},b64e:function(e,t,n){"use strict";var i=n("a8a0"),a=n.n(i);a.a},f4ce:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uInput:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-input/u-input")]).then(n.bind(null,"0a0a"))},uCountTo:function(){return n.e("uview-ui/components/u-count-to/u-count-to").then(n.bind(null,"7251"))},uGap:function(){return n.e("uview-ui/components/u-gap/u-gap").then(n.bind(null,"0d4b"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"44ae"))},uLine:function(){return n.e("uview-ui/components/u-line/u-line").then(n.bind(null,"a939"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"cf37"))},uMask:function(){return n.e("uview-ui/components/u-mask/u-mask").then(n.bind(null,"2cb7"))},uImage:function(){return n.e("uview-ui/components/u-image/u-image").then(n.bind(null,"7f81"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,0==e.payType?e.getPrice():null),i=0==e.payType?e.getPrice():null;e.$mp.data=Object.assign({},{$root:{m0:n,m1:i}})},o=[]}},[["3033","common/runtime","common/vendor"]]]);