(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackages/pay/pay"],{"0c8c":function(e,t,n){},"1b31":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a}));var a={uInput:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-input/u-input")]).then(n.bind(null,"0a0a"))},uLine:function(){return n.e("uview-ui/components/u-line/u-line").then(n.bind(null,"a939"))},uGap:function(){return n.e("uview-ui/components/u-gap/u-gap").then(n.bind(null,"0d4b"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"44ae"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"cf37"))},uMask:function(){return n.e("uview-ui/components/u-mask/u-mask").then(n.bind(null,"2cb7"))},uImage:function(){return n.e("uview-ui/components/u-image/u-image").then(n.bind(null,"7f81"))}},o=function(){var e=this,t=e.$createElement;e._self._c},r=[]},3033:function(e,t,n){"use strict";(function(e){n("921c");a(n("66fd"));var t=a(n("92dc"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},6093:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=u(n("1e31")),o=r(n("c704"));function r(e){return e&&e.__esModule?e:{default:e}}function i(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=a?Object.getOwnPropertyDescriptor(e,o):null;r&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}var c={data:function(){return{show:!1,customStyle:{fontSize:"40rpx",lineHeight:"40rpx",height:"40rpx",fontWeight:"bold"},list:[{name:"余额",value:"YE"},{name:"微信",value:"WX"}],wallet:0,orderData:{},payType:"",paymentType:"YE",current:0}},onShow:function(){this.getWaletDetail()},onLoad:function(e){this.payType=e.payType,2==e.payType&&this.getOrderDetail(e.orderId),this.orderData=e},methods:{get:function(){a.getSubscribeMessage()},getOrderDetail:function(e){var t=this;this.$u.api.getOrderDetail({orderId:e}).then((function(e){t.orderData=JSON.parse(e)}))},charge:function(){e.navigateTo({url:"/pages/charge/charge?flag=1"})},radioChange:function(e){this.paymentType=e.detail.value},getWaletDetail:function(){var e=this;this.$u.api.getWaletDetail().then((function(t){e.wallet=t.totalAmount,e.wallet>e.orderData.orderMoney||e.wallet>e.orderData.commodityPrice?(e.current=0,e.paymentType="YE"):(e.current=1,e.paymentType="WX")}))},submit:function(){var t=this,n=this;if(this.paymentType)if("YE"==this.paymentType&&(this.wallet<this.orderData.commodityPrice||this.wallet<this.orderData.orderMoney))e.showToast({title:"余额不足，请充值，或者使用微信支付",icon:"none"});else{if(0==this.payType&&this.$u.api.createOrder({userId:e.getStorageSync("userId"),shopId:this.orderData.shopId,merchantId:this.orderData.merchantId,commodityId:this.orderData.commodityId,commodityPrice:this.orderData.commodityPrice,carNumber:this.orderData.carNumber,carModel:this.orderData.carModel,userPhone:this.orderData.userPhone,scheduledTime:this.orderData.scheduledTime,orderType:this.orderData.orderType,paymentType:this.paymentType,openId:e.getStorageSync("openid"),orderRemark:this.orderData.orderRemark}).then((function(r){var i=r.orderId;if("WX"==t.paymentType){var u=a.WX_appId,c=a.getNum(),s="prepay_id="+r.prepayid,p="MD5",d=Date.parse(new Date).toString(),l=a.key,y=o.default.md5("appId="+u+"&nonceStr="+c+"&package="+s+"&signType="+p+"&timeStamp="+d+"&key="+l);wx.requestPayment({timeStamp:d,nonceStr:c,package:s,signType:p,paySign:y,success:function(){n.show=!0;var t=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+i})}),1500)};a.getSubscribeMessage(t)},complete:function(e){console.log(e)}})}if("YE"==t.paymentType){n.show=!0;var f=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+i})}),1500)};a.getSubscribeMessage(f)}})),1==this.payType&&this.$u.api.paymentOrder({orderId:this.orderData.orderId,openId:e.getStorageSync("openid"),paymentType:this.paymentType}).then((function(r){var i=r.orderId;if("WX"==t.paymentType){var u=a.WX_appId,c=a.getNum(),s="prepay_id="+r.prepayid,p="MD5",d=Date.parse(new Date).toString(),l=a.key,y=o.default.md5("appId="+u+"&nonceStr="+c+"&package="+s+"&signType="+p+"&timeStamp="+d+"&key="+l);wx.requestPayment({timeStamp:d,nonceStr:c,package:s,signType:p,paySign:y,success:function(t){n.show=!0;var o=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+i})}),1500)};a.getSubscribeMessage(o)},complete:function(e){console.log(e)}})}if("YE"==t.paymentType){n.show=!0;var f=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+i})}),1500)};a.getSubscribeMessage(f)}})),2==this.payType){if("WX"==this.paymentType){var r=this.orderData.id,i=a.WX_appId,u=a.getNum(),c="prepay_id="+this.orderData.prepayId,s="MD5",p=Date.parse(new Date).toString(),d=a.key,l=o.default.md5("appId="+i+"&nonceStr="+u+"&package="+c+"&signType="+s+"&timeStamp="+p+"&key="+d);wx.requestPayment({timeStamp:p,nonceStr:u,package:c,signType:s,paySign:l,success:function(){n.show=!0;var t=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+r})}),1500)};a.getSubscribeMessage(t)},fail:function(t){(new Date).getTime()-n.orderData.createTime>72e5?(e.showLoading({title:"订单支付超时",duration:3e3}),n.$u.api.setOrderStatus({orderId:n.orderData.id,status:"FAIL"}).then((function(t){setTimeout((function(){e.hideLoading(),e.navigateBack()}),1e3)}))):e.showToast({icon:"none",title:"请重新发起支付"})},complete:function(e){}})}"YE"==this.paymentType&&this.$u.api.paymentOrder({orderId:this.orderData.id,openId:e.getStorageSync("openid"),paymentType:this.paymentType}).then((function(a){"YE"==t.paymentType&&(n.show=!0,setTimeout((function(){e.redirectTo({url:"/subPackages/booking/bookingDetail/bookingDetail?orderId="+a.orderId})}),1500))}))}3==this.payType&&this.$u.api.payRescueOrder({orderId:this.orderData.orderId,openId:e.getStorageSync("openid"),paymentType:this.paymentType}).then((function(r){r.orderId;if("WX"==t.paymentType){var i=a.WX_appId,u=a.getNum(),c="prepay_id="+r.prepayid,s="MD5",p=Date.parse(new Date).toString(),d=a.key,l=o.default.md5("appId="+i+"&nonceStr="+u+"&package="+c+"&signType="+s+"&timeStamp="+p+"&key="+d);wx.requestPayment({timeStamp:p,nonceStr:u,package:c,signType:s,paySign:l,success:function(t){console.log(t),n.show=!0;var o=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/rescue/rescue"})}),1500)};a.getSubscribeMessage(o)},complete:function(e){console.log(e)}})}if("YE"==t.paymentType){n.show=!0;var y=function(){setTimeout((function(){e.redirectTo({url:"/subPackages/rescue/rescue"})}),1500)};a.getSubscribeMessage(y)}}))}else e.showToast({title:"请选择支付方式",icon:"none"})}}};t.default=c}).call(this,n("543d")["default"])},"8a9c":function(e,t,n){"use strict";n.r(t);var a=n("6093"),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t["default"]=o.a},"92dc":function(e,t,n){"use strict";n.r(t);var a=n("1b31"),o=n("8a9c");for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);n("d286");var i,u=n("f0c5"),c=Object(u["a"])(o["default"],a["b"],a["c"],!1,null,"5036480c",null,!1,a["a"],i);t["default"]=c.exports},d286:function(e,t,n){"use strict";var a=n("0c8c"),o=n.n(a);o.a}},[["3033","common/runtime","common/vendor"]]]);